# 会员音乐测试指南

## ✅ 准备工作已完成

所有代码和文件都已就绪：
- ✅ 8 个会员音乐文件已复制到 `锚点/会员音乐/`
- ✅ CalmView.swift 已更新，包含会员音乐逻辑
- ✅ 锁定图标和订阅检查已实现
- ✅ MusicOptionView 组件已创建

## 📱 在 Xcode 中的操作步骤

### 步骤 1: 打开项目
```bash
open 锚点.xcodeproj
```

### 步骤 2: 验证文件引用（可选）
由于项目使用文件系统同步，会员音乐文件夹应该会自动被识别。

如果在项目导航器中看不到"会员音乐"文件夹：
1. 右键点击"锚点"文件夹
2. 选择 "Add Files to '锚点'..."
3. 导航到并选择 `锚点/会员音乐` 文件夹
4. **重要**：确保勾选 "Create folder references"（会显示为蓝色文件夹图标）
5. 确保勾选 "Copy items if needed"
6. Target 选择所有相关的 target（锚点 CN、锚点 US 等）
7. 点击 "Add"

### 步骤 3: 清理并构建
```
Command + Shift + K  (Clean Build Folder)
Command + B          (Build)
```

## 🧪 测试场景

### 测试 1: 未订阅用户体验
1. **准备**：确保应用处于未订阅状态
   - 可以在 SubscriptionManager 中临时设置 `isPremium = false`
   
2. **测试步骤**：
   - 打开应用
   - 进入冥想页面（Calm View）
   - 点击"音乐"选项
   
3. **预期结果**：
   - ✅ 看到 16 首音乐（8 首免费 + 8 首会员）
   - ✅ 会员音乐显示小锁图标（右上角）
   - ✅ 会员音乐显示为半透明（60% 不透明度）
   - ✅ 点击会员音乐无反应
   - ✅ 可以正常选择和播放免费音乐

### 测试 2: 已订阅用户体验
1. **准备**：确保应用处于订阅状态
   - 可以在 SubscriptionManager 中临时设置 `isPremium = true`
   
2. **测试步骤**：
   - 打开应用
   - 进入冥想页面
   - 点击"音乐"选项
   
3. **预期结果**：
   - ✅ 看到 16 首音乐，全部可用
   - ✅ 所有音乐都没有锁定图标
   - ✅ 所有音乐都是正常亮度
   - ✅ 可以选择任何音乐
   - ✅ 会员音乐可以正常播放

### 测试 3: 音乐播放功能
1. **测试免费音乐**：
   - 选择"空灵"
   - 开始冥想
   - 确认音乐正常播放
   
2. **测试会员音乐**（需要订阅状态）：
   - 选择"氛围"
   - 开始冥想
   - 确认音乐正常播放

### 测试 4: 视觉效果
1. **锁定图标**：
   - 检查锁定图标位置（右上角）
   - 检查锁定图标颜色（半透明白色）
   - 检查锁定图标大小（不遮挡主图标）

2. **半透明效果**：
   - 会员音乐应该比免费音乐暗淡
   - 但仍然清晰可见

3. **选中状态**：
   - 选中的音乐应该有白色背景高亮
   - 选中的音乐应该有边框

## 🐛 常见问题排查

### 问题 1: 找不到会员音乐文件
**症状**：运行时提示找不到音乐文件

**解决方案**：
1. 检查 Xcode 项目导航器中是否有"会员音乐"文件夹
2. 确保文件夹是蓝色的（folder reference），不是黄色的（group）
3. 右键点击文件夹，选择 "Show in Finder"，确认文件存在
4. 重新添加文件夹引用

### 问题 2: 音乐无法播放
**症状**：选择音乐后没有声音

**解决方案**：
1. 检查 SoundManager 的实现
2. 确认音频文件格式正确（.mp3）
3. 检查设备音量
4. 查看 Xcode 控制台的错误信息

### 问题 3: 锁定图标不显示
**症状**：会员音乐没有锁定图标

**解决方案**：
1. 确认 `isPremium` 属性正确返回 `true`
2. 确认 `SubscriptionManager.shared.isPremium` 返回 `false`
3. 检查 MusicOptionView 的实现

### 问题 4: 订阅状态不正确
**症状**：已订阅但仍显示锁定

**解决方案**：
1. 检查 SubscriptionManager 的订阅状态
2. 确认 StoreKit 配置正确
3. 在测试环境中可以临时修改 `isPremium` 值

## 📊 测试检查清单

### 功能测试
- [ ] 未订阅用户看到锁定图标
- [ ] 未订阅用户无法选择会员音乐
- [ ] 已订阅用户看不到锁定图标
- [ ] 已订阅用户可以选择所有音乐
- [ ] 免费音乐正常播放
- [ ] 会员音乐正常播放（订阅状态）

### UI 测试
- [ ] 锁定图标位置正确
- [ ] 锁定图标大小合适
- [ ] 半透明效果正确
- [ ] 选中状态高亮正确
- [ ] 音乐图标显示正确
- [ ] 音乐名称显示正确

### 交互测试
- [ ] 点击免费音乐可以选择
- [ ] 点击锁定音乐无反应
- [ ] 音乐选择面板打开/关闭流畅
- [ ] 音乐切换流畅

## 🎯 性能检查

- [ ] 音乐列表加载速度快
- [ ] 音乐切换无延迟
- [ ] 内存使用正常
- [ ] 没有内存泄漏

## 📝 测试记录模板

```
测试日期：____________________
测试人员：____________________
设备型号：____________________
iOS 版本：____________________

测试结果：
□ 通过  □ 失败

问题描述：
_________________________________
_________________________________

截图：
[附加截图]
```

## ✨ 测试完成后

如果所有测试通过：
1. ✅ 提交代码
2. ✅ 更新版本号
3. ✅ 准备发布

如果有问题：
1. 记录问题详情
2. 查看常见问题排查
3. 修复后重新测试

---

**祝测试顺利！** 🎵✨

# è®¢é˜…åŠŸèƒ½é›†æˆå®Œæˆ

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. è®¢é˜…ç®¡ç†å™¨ (SubscriptionManager.swift)
- âœ… ä½¿ç”¨ StoreKit 2 å®ç°å®Œæ•´çš„è®¢é˜…ç®¡ç†
- âœ… æ”¯æŒä¸‰ç§è®¢é˜…ç±»å‹ï¼šæœˆåº¦ã€å¹´åº¦ã€æ°¸ä¹…
- âœ… è‡ªåŠ¨ç›‘å¬äº¤æ˜“æ›´æ–°
- âœ… è´­ä¹°éªŒè¯å’ŒçŠ¶æ€åŒæ­¥
- âœ… æ¢å¤è´­ä¹°åŠŸèƒ½
- âœ… ä¼šå‘˜æƒç›Šæ£€æŸ¥

### 2. è®¢é˜…é¡µé¢ (SubscriptionView.swift)
- âœ… ç²¾ç¾çš„ UI è®¾è®¡ï¼Œç¬¦åˆ App æ•´ä½“é£æ ¼
- âœ… æ¸…æ™°å±•ç¤ºå››å¤§ä¼šå‘˜æƒç›Š
- âœ… ä¸‰ç§è®¢é˜…æ–¹æ¡ˆé€‰æ‹©
- âœ… åŠ¨æ€ä»·æ ¼æ˜¾ç¤ºï¼ˆä» StoreKit è·å–ï¼‰
- âœ… 7å¤©å…è´¹è¯•ç”¨æç¤º
- âœ… è´­ä¹°å’Œæ¢å¤è´­ä¹°åŠŸèƒ½
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ

### 3. ä¸ªäººèµ„æ–™é¡µé¢é›†æˆ (ProfileView.swift)
- âœ… ä¼šå‘˜å¡ç‰‡å±•ç¤º
- âœ… "å¼€é€šä¼šå‘˜"æŒ‰é’®è·³è½¬åˆ°è®¢é˜…é¡µé¢

### 4. æµ‹è¯•é…ç½® (Configuration.storekit)
- âœ… æœ¬åœ°æµ‹è¯•ç”¨çš„ StoreKit é…ç½®æ–‡ä»¶
- âœ… åŒ…å«æ‰€æœ‰ä¸‰ç§äº§å“é…ç½®
- âœ… é…ç½®äº† 7 å¤©å…è´¹è¯•ç”¨

### 5. æ–‡æ¡£
- âœ… App Store Connect é…ç½®æŒ‡å—
- âœ… äº§å“ ID å’Œä»·æ ¼è¯´æ˜

## ğŸ“‹ ä¸‹ä¸€æ­¥éœ€è¦åšçš„

### 1. Xcode é¡¹ç›®é…ç½®
```
1. æ‰“å¼€ Xcode é¡¹ç›®
2. é€‰æ‹© Target -> Signing & Capabilities
3. æ·»åŠ  "In-App Purchase" capability
4. åœ¨ Scheme ä¸­é…ç½® StoreKit Configuration æ–‡ä»¶ç”¨äºæµ‹è¯•
```

### 2. App Store Connect é…ç½®
æŒ‰ç…§ `APP_STORE_SETUP.md` æ–‡æ¡£ï¼š
- åˆ›å»ºä¸‰ä¸ªå†…è´­äº§å“
- é…ç½®è®¢é˜…ç¾¤ç»„
- è®¾ç½®å…è´¹è¯•ç”¨
- æ·»åŠ äº§å“æè¿°å’Œæˆªå›¾

### 3. åœ¨ä»£ç ä¸­ä½¿ç”¨è®¢é˜…çŠ¶æ€

åœ¨éœ€è¦æ£€æŸ¥ä¼šå‘˜æƒç›Šçš„åœ°æ–¹ä½¿ç”¨ï¼š

```swift
// æ£€æŸ¥æ˜¯å¦æ˜¯ä¼šå‘˜
if SubscriptionManager.shared.isPremium {
    // æ˜¾ç¤ºé«˜çº§åŠŸèƒ½
}

// æ£€æŸ¥ç‰¹å®šåŠŸèƒ½æƒé™
if SubscriptionManager.shared.hasAccessToFeature(.allSphereMaterials) {
    // è§£é”æ‰€æœ‰æµä½“çƒ
}
```

### 4. éœ€è¦é™åˆ¶çš„åŠŸèƒ½

æ ¹æ®ä½ çš„ä»˜è´¹ç‚¹ï¼Œéœ€è¦åœ¨ä»¥ä¸‹åœ°æ–¹æ·»åŠ ä¼šå‘˜æ£€æŸ¥ï¼š

#### a. æµä½“å…‰å½±çƒæè´¨
åœ¨ `FluidSphereView` æˆ–é€‰æ‹©æè´¨çš„åœ°æ–¹ï¼š
```swift
// æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨è¯¥æè´¨
if material != .default && !SubscriptionManager.shared.isPremium {
    // æ˜¾ç¤ºå‡çº§æç¤º
    showSubscriptionPrompt = true
}
```

#### b. å†¥æƒ³éŸ³ä¹åº“
åœ¨éŸ³ä¹é€‰æ‹©ç•Œé¢ï¼š
```swift
if isPremiumMusic && !SubscriptionManager.shared.isPremium {
    // æ˜¾ç¤ºé”å®šçŠ¶æ€
}
```

#### c. æ·±åº¦æ•°æ®åˆ†æ
åœ¨ `MyStatsView` ä¸­ï¼š
```swift
if !SubscriptionManager.shared.isPremium {
    // åªæ˜¾ç¤ºåŸºç¡€æ•°æ®
    // é«˜çº§åˆ†ææ˜¾ç¤ºå‡çº§æç¤º
}
```

#### d. å…‰çƒå®šåˆ¶
åœ¨è®¾ç½®æˆ–å®šåˆ¶ç•Œé¢ï¼š
```swift
if !SubscriptionManager.shared.hasAccessToFeature(.customization) {
    // æ˜¾ç¤ºå‡çº§æç¤º
}
```

### 5. æ·»åŠ å‡çº§æç¤ºç»„ä»¶

åˆ›å»ºä¸€ä¸ªé€šç”¨çš„å‡çº§æç¤ºè§†å›¾ï¼š
```swift
struct UpgradePromptView: View {
    let feature: String
    @Binding var isPresented: Bool
    
    var body: some View {
        // æ˜¾ç¤ºåŠŸèƒ½è¯´æ˜å’Œå‡çº§æŒ‰é’®
    }
}
```

### 6. æµ‹è¯•æ¸…å•

- [ ] æœ¬åœ° StoreKit æµ‹è¯•ï¼ˆä½¿ç”¨ Configuration.storekitï¼‰
- [ ] æ²™ç›’ç¯å¢ƒæµ‹è¯•
- [ ] è´­ä¹°æµç¨‹æµ‹è¯•
- [ ] æ¢å¤è´­ä¹°æµ‹è¯•
- [ ] è®¢é˜…çŠ¶æ€åŒæ­¥æµ‹è¯•
- [ ] å…è´¹è¯•ç”¨æµ‹è¯•
- [ ] å–æ¶ˆè®¢é˜…æµ‹è¯•
- [ ] ä¼šå‘˜æƒç›Šæ£€æŸ¥æµ‹è¯•

### 7. éšç§å’Œæ³•å¾‹

- [ ] æ·»åŠ éšç§æ”¿ç­–é¡µé¢
- [ ] æ·»åŠ æœåŠ¡æ¡æ¬¾é¡µé¢
- [ ] åœ¨ SubscriptionView ä¸­é“¾æ¥è¿™äº›é¡µé¢
- [ ] ç¡®ä¿è®¢é˜…è¯´æ˜æ¸…æ™°æ˜ç¡®

## ğŸ¯ äº§å“é…ç½®æ‘˜è¦

| ç±»å‹ | Product ID | ä»·æ ¼ | è¯•ç”¨æœŸ |
|------|-----------|------|--------|
| æœˆåº¦è®¢é˜… | com.chengyu.anchor.monthly | Â¥12.99/æœˆ | 7å¤© |
| å¹´åº¦è®¢é˜… | com.chengyu.anchor.yearly | Â¥129.99/å¹´ | 7å¤© |
| æ°¸ä¹…ä¹°æ–­ | com.chengyu.anchor.lifetime | Â¥299 | æ—  |

## ğŸ’¡ ä¼šå‘˜æƒç›Š

1. âœ¨ è§£é”æ‰€æœ‰æµä½“å…‰å½±çƒï¼ˆç†”å²©ã€å†°æ™¶ã€å¢¨æ°´ç­‰ï¼‰
2. ğŸµ ä¸“ä¸šå†¥æƒ³éŸ³ä¹åº“
3. ğŸ“Š æ·±åº¦å¿ƒæ™ºæ´å¯Ÿä¸è½¨è¿¹åˆ†æ
4. ğŸ¨ å…‰çƒå¾®è§‚å½¢è±¡å®šåˆ¶

## ğŸ”§ æŠ€æœ¯æ ˆ

- StoreKit 2 (ç°ä»£åŒ–çš„å†…è´­ API)
- SwiftUI (åŸç”Ÿ UI æ¡†æ¶)
- Combine (å“åº”å¼ç¼–ç¨‹)
- async/await (å¼‚æ­¥å¤„ç†)

## ğŸ“ æ”¯æŒ

å¦‚æœç”¨æˆ·é‡åˆ°è´­ä¹°é—®é¢˜ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤ Apple ID ç™»å½•çŠ¶æ€
3. å°è¯•æ¢å¤è´­ä¹°
4. è”ç³»å®¢æœï¼ˆåœ¨å¸®åŠ©ä¸åé¦ˆé¡µé¢ï¼‰

# App Store Connect 订阅配置详细步骤

## 前提条件

1. ✅ 已有 Apple Developer 账号（¥688/年）
2. ✅ App 已在 App Store Connect 中创建
3. ✅ 已签署付费应用协议（Paid Applications Agreement）

## 第一步：签署协议（如果还没有）

### 1.1 进入协议页面
1. 登录 [App Store Connect](https://appstoreconnect.apple.com)
2. 点击右上角账户名
3. 选择 "协议、税务和银行业务"

### 1.2 签署付费应用协议
1. 找到 "Paid Applications" 协议
2. 点击 "Request"（如果还没签署）
3. 填写以下信息：
   - 联系信息
   - 银行账户信息（用于接收收入）
   - 税务信息
4. 提交并等待审核（通常 1-2 个工作日）

**重要**：没有签署这个协议，无法创建付费产品！

## 第二步：创建订阅群组

### 2.1 进入订阅管理
1. 在 App Store Connect 中选择你的 App
2. 点击左侧 "功能" 标签
3. 选择 "订阅"
4. 点击 "+" 创建订阅群组

### 2.2 配置订阅群组
- **群组名称**：锚点会员
- **群组参考名称**：Anchor Premium Membership
- 点击 "创建"

## 第三步：创建月度订阅

### 3.1 添加订阅
1. 在刚创建的订阅群组中，点击 "+" 添加订阅
2. 选择 "自动续期订阅"

### 3.2 基本信息
- **参考名称**：锚点月度会员
- **产品 ID**：`com.chengyu.anchor.monthly`
- **订阅时长**：1 个月

### 3.3 订阅价格
1. 点击 "订阅价格"
2. 选择 "手动设置价格"
3. 选择价格等级或自定义：
   - 中国：¥18
   - 美国：$2.99
   - 其他地区：自动换算
4. 点击 "下一步"

### 3.4 本地化信息（中文）
- **显示名称**：月度会员
- **描述**：
  ```
  解锁澄域 PLUS 所有会员专享功能：
  • 8 首专属冥想音乐
  • 3 种高级球体材质
  • 深度数据分析
  
  订阅将自动续订，可随时取消。
  ```

### 3.5 本地化信息（英文）
- **显示名称**：Monthly Membership
- **描述**：
  ```
  Unlock all Anchor PLUS premium features:
  • 8 exclusive meditation tracks
  • 3 advanced sphere materials
  • Deep analytics
  
  Auto-renewable. Cancel anytime.
  ```

### 3.6 审核信息
- **审核备注**：订阅功能用于解锁高级冥想音乐和球体材质
- **审核截图**：上传订阅页面和会员功能的截图

## 第四步：创建年度订阅

重复第三步，但修改：
- **参考名称**：锚点年度会员
- **产品 ID**：`com.chengyu.anchor.yearly`
- **订阅时长**：1 年
- **价格**：
  - 中国：¥128
  - 美国：$19.99
- **显示名称**：年度会员（节省 40%）
- **描述**：
  ```
  解锁澄域 PLUS 所有会员专享功能，每年仅需 ¥128：
  • 8 首专属冥想音乐
  • 3 种高级球体材质
  • 深度数据分析
  • 相当于每月 ¥10.67，节省 40%
  
  订阅将自动续订，可随时取消。
  ```

## 第五步：创建终身购买

### 5.1 添加 App 内购买项目
1. 返回 "功能" 页面
2. 选择 "App 内购买项目"
3. 点击 "+" 创建

### 5.2 选择类型
- 选择 "非消耗型项目"

### 5.3 基本信息
- **参考名称**：锚点终身会员
- **产品 ID**：`com.chengyu.anchor.lifetime`

### 5.4 价格
- 中国：¥298
- 美国：$49.99

### 5.5 本地化信息（中文）
- **显示名称**：终身会员
- **描述**：
  ```
  一次购买，永久使用所有会员功能：
  • 8 首专属冥想音乐
  • 3 种高级球体材质
  • 深度数据分析
  • 未来所有新增会员功能
  
  无需续订，永久拥有。
  ```

## 第六步：配置 Xcode 项目

### 6.1 添加 StoreKit Capability
1. 在 Xcode 中选择项目
2. 选择 target "锚点 CN"
3. 点击 "Signing & Capabilities"
4. 点击 "+ Capability"
5. 添加 "In-App Purchase"

### 6.2 配置 StoreKit Configuration 文件
1. 打开 `Configuration.storekit`
2. 添加三个产品（与 App Store Connect 中的配置一致）
3. 设置测试价格

### 6.3 在 Scheme 中启用 StoreKit
1. 点击 Xcode 顶部的 Scheme（锚点 CN）
2. 选择 "Edit Scheme..."
3. 选择 "Run" → "Options"
4. 在 "StoreKit Configuration" 中选择 `Configuration.storekit`

## 第七步：测试

### 7.1 本地测试（使用 StoreKit Configuration）
1. 运行 App
2. 进入订阅页面
3. 尝试购买（使用测试价格）
4. 验证会员功能解锁

### 7.2 沙盒测试（真实流程）
1. 在 App Store Connect 创建沙盒测试账号
2. 在设备上登录沙盒账号
3. 运行 App（使用 TestFlight 或直接运行）
4. 测试真实购买流程
5. 验证收据验证
6. 测试恢复购买

### 7.3 测试场景
- [ ] 购买月度订阅
- [ ] 购买年度订阅
- [ ] 购买终身会员
- [ ] 恢复购买
- [ ] 订阅升级（月度→年度）
- [ ] 订阅降级（年度→月度）
- [ ] 取消订阅
- [ ] 订阅过期后权限撤销
- [ ] 会员音乐锁定/解锁
- [ ] 球体材质锁定/解锁

## 第八步：提交审核

### 8.1 准备审核材料
1. **App 截图**：展示订阅功能和会员权益
2. **审核备注**：
   ```
   订阅功能说明：
   - 月度订阅：¥18/月，自动续订
   - 年度订阅：¥128/年，自动续订
   - 终身购买：¥298，一次性购买
   
   会员权益：
   - 8 首专属冥想音乐
   - 3 种高级球体材质
   - 深度数据分析
   
   测试账号：[提供沙盒测试账号]
   ```

### 8.2 提交
1. 在 App Store Connect 中准备新版本
2. 上传构建版本
3. 填写版本信息
4. 提交审核

## 常见问题

### Q1: 产品 ID 可以修改吗？
**A**: 不可以。产品 ID 一旦创建就无法修改。如果需要修改，只能删除重建（会丢失历史数据）。

### Q2: 价格可以修改吗？
**A**: 可以。但价格变更需要审核，且会影响现有订阅用户。

### Q3: 如何处理退款？
**A**: 用户需要通过 Apple 申请退款。开发者无法直接退款，但可以在 App Store Connect 中查看退款记录。

### Q4: 订阅收入何时到账？
**A**: Apple 每月结算一次，扣除 30% 手续费后，在次月底前转账到你的银行账户。

### Q5: 如何查看订阅数据？
**A**: 在 App Store Connect 的 "销售和趋势" 中可以查看详细的订阅数据。

## 快速检查清单

在提交审核前，确认：
- [ ] 所有产品 ID 与代码中一致
- [ ] 价格已设置
- [ ] 本地化信息完整（中文+英文）
- [ ] 订阅群组配置正确
- [ ] 沙盒测试通过
- [ ] 订阅条款和隐私政策已添加
- [ ] App 中有"管理订阅"链接
- [ ] 恢复购买功能正常

## 🎉 准备上线！

完成以上步骤后，你的 App 就可以开始收费了！

**预计时间**：
- 配置产品：30 分钟
- 测试：1-2 小时
- 审核：1-3 天

祝你上线顺利！💰

# 🚀 真实收费配置指南 - 快速上手版

## ✅ 代码状态检查

你的代码已经准备好了：
- ✅ `isPremium` 默认为 `false`（非会员）
- ✅ `subscriptionType` 默认为 `.none`（无订阅）
- ✅ 会员音乐锁定功能已实现
- ✅ 球体材质访问控制已启用
- ✅ StoreKit 2 集成完成

## 📋 产品配置信息

### 产品 ID（已在代码中定义）
```
月度订阅：com.chengyu.anchor.monthly
年度订阅：com.chengyu.anchor.yearly
终身购买：com.chengyu.anchor.lifetime
```

### 建议定价
| 产品 | 价格（中国） | 价格（美国） | 说明 |
|------|-------------|-------------|------|
| 月度订阅 | ¥18 | $4.99 | 自动续订 |
| 年度订阅 | ¥128 | $49.99 | 节省 17% |
| 终身购买 | ¥298 | $119.99 | 一次性购买 |

---

## 🎯 第一步：签署付费应用协议（必须）

### 1. 登录 App Store Connect
访问：https://appstoreconnect.apple.com

### 2. 进入协议页面
- 点击右上角账户名
- 选择「协议、税务和银行业务」

### 3. 签署协议
找到「Paid Applications」协议：
- 如果状态是「Request」→ 点击开始签署
- 填写：
  - ✅ 联系信息
  - ✅ 银行账户信息（用于收款）
  - ✅ 税务信息
- 提交后等待 1-2 个工作日审核

⚠️ **重要**：没有签署这个协议，无法创建任何付费产品！

---

## 🎯 第二步：在 App Store Connect 创建产品

### 1. 进入你的 App
- 在 App Store Connect 选择「锚点」App
- 点击左侧「功能」标签

### 2. 创建订阅群组
- 点击「订阅」
- 点击「+」创建订阅群组
- 群组名称：`锚点会员`
- 群组参考名称：`Anchor Premium`
- 点击「创建」

### 3. 创建月度订阅
在刚创建的订阅群组中：

**基本信息**
- 点击「+」添加订阅
- 类型：自动续期订阅
- 参考名称：`锚点月度会员`
- 产品 ID：`com.chengyu.anchor.monthly`
- 订阅时长：1 个月

**价格设置**
- 点击「订阅价格」
- 中国：¥18
- 美国：$4.99
- 其他地区：自动换算

**本地化信息（中文）**
- 显示名称：`月度会员`
- 描述：
```
解锁澄域 PLUS 所有会员专享功能：
• 8 首专属冥想音乐
• 3 种高级球体材质
• 深度数据分析

订阅将自动续订，可随时取消。
```

**本地化信息（英文）**
- 显示名称：`Monthly Membership`
- 描述：
```
Unlock all Anchor PLUS premium features:
• 8 exclusive meditation tracks
• 3 advanced sphere materials
• Deep analytics

Auto-renewable. Cancel anytime.
```

### 4. 创建年度订阅
重复上面的步骤，但修改：
- 参考名称：`锚点年度会员`
- 产品 ID：`suo`
- 订阅时长：1 年
- 价格：中国 ¥128，美国 $49.99
- 显示名称：`年度会员（节省 17%）`
- 描述：
```
解锁澄域 PLUS 所有会员专享功能，每年仅需 ¥128：
• 8 首专属冥想音乐
• 3 种高级球体材质
• 深度数据分析
• 相当于每月 ¥10.67，节省 17%

订阅将自动续订，可随时取消。
```

### 5. 创建终身购买
- 返回「功能」页面
- 选择「App 内购买项目」
- 点击「+」创建
- 类型：**非消耗型项目**
- 参考名称：`锚点终身会员`
- 产品 ID：`com.chengyu.anchor.lifetime`
- 价格：中国 ¥298，美国 $119.99
- 显示名称：`终身会员`
- 描述：
```
一次购买，永久使用所有会员功能：
• 8 首专属冥想音乐
• 3 种高级球体材质
• 深度数据分析
• 未来所有新增会员功能

无需续订，永久拥有。
```

---

## 🎯 第三步：配置 Xcode 项目

### 1. 添加 In-App Purchase Capability
1. 在 Xcode 中打开项目
2. 选择 target「锚点 CN」或「锚点 US」
3. 点击「Signing & Capabilities」标签
4. 点击「+ Capability」
5. 搜索并添加「In-App Purchase」

### 2. 配置 StoreKit Configuration（用于本地测试）
1. 打开 `Configuration.storekit` 文件
2. 确认三个产品已配置：
   - com.chengyu.anchor.monthly
   - com.chengyu.anchor.yearly
   - com.chengyu.anchor.lifetime
3. 如果没有，手动添加

### 3. 在 Scheme 中启用 StoreKit
1. 点击 Xcode 顶部的 Scheme（锚点 CN）
2. 选择「Edit Scheme...」
3. 选择「Run」→「Options」
4. 在「StoreKit Configuration」中选择 `Configuration.storekit`

---

## 🎯 第四步：测试

### 方式 1：本地测试（推荐先用这个）
1. 在 Xcode 中运行 App
2. 进入订阅页面
3. 尝试购买（使用 StoreKit Configuration 的测试价格）
4. 验证会员功能解锁
5. 测试恢复购买

### 方式 2：沙盒测试（真实流程）
1. 在 App Store Connect 创建沙盒测试账号：
   - 用户和访问 → 沙盒技术测试员
   - 点击「+」创建测试账号
   - 填写邮箱和密码（记住这个账号）

2. 在 iPhone 上登录沙盒账号：
   - 设置 → App Store → 沙盒账户
   - 登录刚创建的测试账号

3. 运行 App 测试：
   - 在 Xcode 中运行到真机
   - 进入订阅页面
   - 尝试购买（会弹出沙盒购买确认）
   - 验证功能解锁

### 测试清单
- [ ] 购买月度订阅
- [ ] 购买年度订阅
- [ ] 购买终身会员
- [ ] 恢复购买功能
- [ ] 会员音乐解锁（8首会员音乐可用）
- [ ] 球体材质解锁（ink, neon, void 可用）
- [ ] 深度解析页面可访问

---

## 🎯 第五步：提交审核

### 1. 准备审核材料
**截图要求**：
- 订阅页面截图（展示三个订阅选项）
- 会员功能截图（会员音乐、高级材质）
- 订阅管理页面截图

**审核备注**：
```
订阅功能说明：
- 月度订阅：¥18/月 或 $4.99/月，自动续订
- 年度订阅：¥128/年 或 $49.99/年，自动续订
- 终身购买：¥298 或 $119.99，一次性购买

会员权益：
- 8 首专属冥想音乐
- 3 种高级球体材质（ink, neon, void）
- 深度数据分析

测试账号：[提供沙盒测试账号和密码]
```

### 2. 提交 App 审核
1. 在 App Store Connect 准备新版本
2. 上传构建版本（Archive → Distribute）
3. 填写版本信息
4. 添加截图和审核备注
5. 提交审核

---

## ⚠️ 常见问题

### Q1: 产品 ID 输入错误怎么办？
**A**: 产品 ID 一旦创建无法修改。如果错了，只能删除重建。所以创建时一定要仔细核对！

### Q2: 为什么看不到产品？
**A**: 可能原因：
1. 付费应用协议未签署
2. 产品状态不是「准备提交」
3. 等待几分钟让 App Store Connect 同步

### Q3: 沙盒测试时提示「无法连接到 iTunes Store」
**A**: 
1. 确认已登录沙盒测试账号
2. 退出真实 Apple ID，只保留沙盒账号
3. 重启 App

### Q4: 购买后没有解锁功能
**A**: 
1. 检查 Xcode 控制台日志
2. 确认 `isPremium` 变为 `true`
3. 尝试「恢复购买」
4. 重启 App

### Q5: 如何测试订阅过期？
**A**: 沙盒环境中订阅会加速过期：
- 1 个月订阅 → 5 分钟后过期
- 1 年订阅 → 1 小时后过期

---

## 📊 收入预估

假设你的 App 有一定用户量：

| 用户数 | 月度订阅 | 年度订阅 | 终身购买 | 月收入 |
|--------|---------|---------|---------|--------|
| 100 人 | 50 人 | 30 人 | 20 人 | ¥2,220 |
| 500 人 | 250 人 | 150 人 | 100 人 | ¥11,100 |
| 1000 人 | 500 人 | 300 人 | 200 人 | ¥22,200 |

*注：Apple 会扣除 30% 手续费，实际到手约 70%*

---

## ✅ 最终检查清单

在提交审核前确认：
- [ ] 付费应用协议已签署
- [ ] 所有产品已创建并提交审核
- [ ] 产品 ID 与代码完全一致
- [ ] 价格已设置
- [ ] 中英文本地化信息完整
- [ ] Xcode 中已添加 In-App Purchase Capability
- [ ] 沙盒测试通过
- [ ] 订阅条款和隐私政策已添加
- [ ] App 中有「管理订阅」链接
- [ ] 恢复购买功能正常

---

## 🎉 完成！

完成以上步骤后，你的 App 就可以开始真实收费了！

**预计时间**：
- 配置产品：30-60 分钟
- 测试：1-2 小时
- 审核：1-3 天

**下一步**：
1. 先完成本地测试
2. 再进行沙盒测试
3. 确认无误后提交审核
4. 等待审核通过
5. 开始赚钱！💰

祝你上线顺利！有问题随时问我。
